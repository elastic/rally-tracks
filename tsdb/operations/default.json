{
  "name": "index",
  "operation-type": "bulk",
  "bulk-size": {{bulk_size | default(5000)}},
  "ingest-percentage": {{ingest_percentage | default(100)}}
},
{
  "name": "default",
  "operation-type": "search",
  "body": {
    "query": {
      "match_all": {}
    }
  }
},
{
  "name": "default_1k",
  "operation-type": "search",
  "body": {
    "query": {
      "match_all": {}
    },
    "size": 1000
  }
},
{
  "name": "search_by_doc_id",
  "operation-type": "search",
  "detailed-results": true,
  "assertions": [
    {
      "property": "hits",
      "condition": "==",
      "value": 4
    }
  ],
  "body": {
    "query": {
      "terms": {
        "_id": [
          "xqRz7JSW4hGturbiAAABeRwHA58",
          "QBJ7zzj0pGd4pRawAAABeR1ZbMQ",
          "OWcU2UA5Xj8-fOqdAAABeRrCsc0",
          "yarBSucyUHsSS-x8AAABeRrCsc0"
        ]
      }
    }
  }
},
{
  "name": "get-xqRz7JSW4hGturbiAAABeRwHA58",
  "operation-type": "raw-request",
  "method": "GET",
  "path": "/tsdb/_doc/xqRz7JSW4hGturbiAAABeRwHA58"
},
{
  "name": "get-QBJ7zzj0pGd4pRawAAABeR1ZbMQ",
  "operation-type": "raw-request",
  "method": "GET",
  "path": "/tsdb/_doc/QBJ7zzj0pGd4pRawAAABeR1ZbMQ"
},
{
  "name": "get-OWcU2UA5Xj8-fOqdAAABeRrCsc0",
  "operation-type": "raw-request",
  "method": "GET",
  "path": "/tsdb/_doc/OWcU2UA5Xj8-fOqdAAABeRrCsc0"
},
{
  "name": "get-yarBSucyUHsSS-x8AAABeRrCsc0",
  "operation-type": "raw-request",
  "method": "GET",
  "path": "/tsdb/_doc/yarBSucyUHsSS-x8AAABeRrCsc0"
},
{
  "name": "mget",
  "operation-type": "raw-request",
  "path": "/tsdb/_mget",
  "method": "GET",
  "body": {
    "docs": [
      {
        "_index": "tsdb",
        "_id": "xqRz7JSW4hGturbiAAABeRwHA58"
      },{
        "_index": "tsdb",
        "_id": "QBJ7zzj0pGd4pRawAAABeR1ZbMQ"
      },{
        "_index": "tsdb",
        "_id": "OWcU2UA5Xj8-fOqdAAABeRrCsc0"
      },{
        "_index": "tsdb",
        "_id": "yarBSucyUHsSS-x8AAABeRrCsc0"
      }
    ]
  }
},
{
  "name": "date-histo-entire-range-1m",
  "operation-type": "search",
  "index": "tsdb-1m",
  "body": {
    "size": 0,
    "aggs": {
      "date": {
        "date_histogram": {
          "field": "@timestamp",
          "fixed_interval": "1m"
        }
      }
    }
  }
},
{
  "name": "date-histo-entire-range-1h",
  "operation-type": "search",
  "index": "tsdb-1h",
  "body": {
    "size": 0,
    "aggs": {
      "date": {
        "date_histogram": {
          "field": "@timestamp",
          "fixed_interval": "1h"
        }
      }
    }
  }
},
{
  "name": "date-histo-entire-range-1d",
  "operation-type": "search",
  "index": "tsdb-1d",
  "body": {
    "size": 0,
    "aggs": {
      "date": {
        "date_histogram": {
          "field": "@timestamp",
          "fixed_interval": "1d"
        }
      }
    }
  }
},
{
  "name": "date-histo-entire-range",
  "operation-type": "search",
  {%- if ingest_mode is defined and ingest_mode == "data_stream" %}
  "index": "k8s",
  {%- else %}
  "index": "tsdb",
  {% endif %}
  "body": {
    "size": 0,
    "aggs": {
      "date": {
        "date_histogram": {
          "field": "@timestamp",
          "fixed_interval": "1d"
        }
      }
    }
  }
},
{
  "name": "date-histo-memory-usage-hour",
  "operation-type": "search",
  {%- if ingest_mode is defined and ingest_mode == "data_stream" %}
  "index": "k8s",
  {%- else %}
  "index": "tsdb",
  {% endif %}
  "body": {
    "size": 0,
    "aggs": {
      "by_date": {
        "date_histogram": {
          "field": "@timestamp",
          "fixed_interval": "1h"
        },
        "aggs": {
          "ts": {
            "time_series": {
              "keyed": false
            },
            "aggs": {
              "total_memory_usage_by_date": {
                "sum": {
                  "field": "kubernetes.container.memory.usage.bytes"
                }
              }
            }
          },
          "min_total_memory_usage_by_date": {
            "min_bucket": {
              "buckets_path": "ts>total_memory_usage_by_date"
            }
          }
        }
      }
    }
  }
},
{
  "name": "date-histo-memory-usage-day",
  "operation-type": "search",
  {%- if ingest_mode is defined and ingest_mode == "data_stream" %}
  "index": "k8s",
  {%- else %}
  "index": "tsdb",
  {% endif %}
  "body": {
    "size": 0,
    "aggs": {
      "by_date": {
        "date_histogram": {
          "field": "@timestamp",
          "fixed_interval": "1d"
        },
        "aggs": {
          "ts": {
            "time_series": {
              "keyed": false
            },
            "aggs": {
              "total_memory_usage_by_date": {
                "sum": {
                  "field": "kubernetes.container.memory.usage.bytes"
                }
              }
            }
          },
          "min_total_memory_usage_by_date": {
            "min_bucket": {
              "buckets_path": "ts>total_memory_usage_by_date"
            }
          }
        }
      }
    }
  }
},
{
  "name": "terms-container-name-memory-usage",
  "operation-type": "search",
  {%- if ingest_mode is defined and ingest_mode == "data_stream" %}
  "index": "k8s",
  {%- else %}
  "index": "tsdb",
  {% endif %}
  "body": {
    "size": 0,
    "aggs": {
      "container_name": {
        "terms": {
          "field": "kubernetes.container.name"
        },
        "aggs": {
          "ts": {
            "time_series": {
              "keyed": false
            },
            "aggs": {
              "total_memory_usage_by_container_name": {
                "sum": {
                  "field": "kubernetes.container.memory.usage.bytes"
                }
              }
            }
          },
          "min_total_memory_usage_by_container_name": {
            "min_bucket": {
              "buckets_path": "ts>total_memory_usage_by_container_name"
            }
          }
        }
      }
    }
  }
},
{
  "name": "terms-container-image-memory-usage",
  "operation-type": "search",
  {%- if ingest_mode is defined and ingest_mode == "data_stream" %}
  "index": "k8s",
  {%- else %}
  "index": "tsdb",
  {% endif %}
  "body": {
    "size": 0,
    "aggs": {
      "container_image": {
        "terms": {
          "field": "kubernetes.container.image"
        },
        "aggs": {
          "ts": {
            "time_series": {
              "keyed": false
            },
            "aggs": {
              "total_memory_usage_by_container_image": {
                "sum": {
                  "field": "kubernetes.container.memory.usage.bytes"
                }
              }
            }
          },
          "min_total_memory_usage_by_container_image": {
            "min_bucket": {
              "buckets_path": "ts>total_memory_usage_by_container_image"
            }
          }
        }
      }
    }
  }
},
{
  "name": "esql-fetch-500",
  "description": "Grab 500 documents",
  "operation-type": "esql",
  {%- if ingest_mode is defined and ingest_mode == "data_stream" %}
  "query": "FROM k8s | LIMIT 500"
  {%- else %}
  "query": "FROM tsdb | LIMIT 500"
  {% endif %}
}
