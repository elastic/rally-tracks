{% import "rally.helpers" as rally with context %}
{% set p_snapshot_repo_name = (snapshot_repo_name | default("my_repo")) %}
{% set p_snapshot_repo_type = (snapshot_repo_type | default("file")) %}
{% set p_snapshot_repo_settings = (snapshot_repo_settings | default({
  "bucket": snapshot_bucket | default("test-bucket"),
  "client": "default",
  "base_path": snapshot_base_path | default("observability/logging"),
  "max_snapshot_bytes_per_sec": -1,
  "readonly": snapshot_repo_readonly | default(false)
}))%}


{
  "version": 2,
  "description": "Tutorial benchmark for Rally",
  "indices": [
    {
      "name": "geonames",
      "body": "index.json"
    }
  ],
  "corpora": [
    {
      "name": "rally-tutorial",
      "documents": [
        {
          "source-file": "documents.json",
          "document-count": 100000,
          "uncompressed-bytes": 13281518
        }
      ]
    }
  ],
  "schedule": [
    {
      "name": "register-snapshot-repository",
      "operation": {
        "operation-type": "create-snapshot-repository",
        "repository": "the-snapshot-repo",
        "body": {
          "type": "fs",
          "settings": {
            "location": "/mount/backups/my_v7_repo_location"
          }
        }
      }
    },
    {
      "operation": {
        "operation-type": "restore-snapshot",
        "repository": "the-snapshot-repo",
        "snapshot": "daily-snap-2025.01.30-cmb824g6s_ktgap3x8nuoq",
        "wait-for-completion": false,
        "body": {
          "indices": "some-index",
          "ignore_unavailable": false,
          "include_global_state": false,
          "rename_pattern": "(.+)",
          "rename_replacement": "$1-1"
        }
      }
    },
    {
      "operation": {
        "operation-type": "wait-for-recovery",
        "index": "some-index-1"
      }
    }
  ]
}
