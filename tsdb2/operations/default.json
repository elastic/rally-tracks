{
  "name": "index",
  "operation-type": "bulk",
  "bulk-size": {{bulk_size | default(5000)}},
  "ingest-percentage": {{ingest_percentage | default(100)}}
},
{
  "name": "cpu_usage_by_pod_last_3_hours",
  "operation-type": "search",
  "body": {
    "aggs": {
      "0": {
        "terms": {
          "field": "kubernetes.pod.name",
          "order": {
            "2": "desc"
          },
          "size": 100
        },
        "aggs": {
          "1": {
            "date_histogram": {
              "field": "@timestamp",
              "fixed_interval": "30s",
              "time_zone": "Europe/Athens",
              "extended_bounds": {
                "min": "2023-01-19T10:38:09.807Z",
                "max": "2023-01-19T13:38:09.807Z"
              }
            },
            "aggs": {
              "2": {
                "avg": {
                  "field": "kubernetes.pod.cpu.usage.limit.pct"
                }
              }
            }
          },
          "2": {
            "avg": {
              "field": "kubernetes.pod.cpu.usage.limit.pct"
            }
          }
        }
      }
    },
    "size": 0,
    "fields": [
      {
        "field": "@timestamp",
        "format": "date_time"
      },
      {
        "field": "event.ingested",
        "format": "date_time"
      },
      {
        "field": "process.cpu.start_time",
        "format": "date_time"
      },
      {
        "field": "system.process.cpu.start_time",
        "format": "date_time"
      }
    ],
    "script_fields": {},
    "stored_fields": [
      "*"
    ],
    "runtime_mappings": {},
    "_source": {
      "excludes": []
    },
    "query": {
      "bool": {
        "must": [],
        "filter": [
          {
            "match_phrase": {
              "data_stream.dataset": "kubernetes.pod"
            }
          },
          {
            "range": {
              "@timestamp": {
                "format": "strict_date_optional_time",
                "gte": "2023-01-19T10:38:09.807Z",
                "lte": "2023-01-19T13:38:09.807Z"
              }
            }
          }
        ],
        "should": [],
        "must_not": []
      }
    }
  }  
},
{
  "name": "cpu_usage_by_pod_last_15_minutes",
  "operation-type": "search",
  "body": {
    "aggs": {
      "0": {
        "terms": {
          "field": "kubernetes.pod.name",
          "order": {
            "2": "desc"
          },
          "size": 100
        },
        "aggs": {
          "1": {
            "date_histogram": {
              "field": "@timestamp",
              "fixed_interval": "30s",
              "time_zone": "Europe/Athens",
              "extended_bounds": {
                "min": "2023-01-19T13:23:09.807Z",
                "max": "2023-01-19T13:38:09.807Z"
              }
            },
            "aggs": {
              "2": {
                "avg": {
                  "field": "kubernetes.pod.cpu.usage.limit.pct"
                }
              }
            }
          },
          "2": {
            "avg": {
              "field": "kubernetes.pod.cpu.usage.limit.pct"
            }
          }
        }
      }
    },
    "size": 0,
    "fields": [
      {
        "field": "@timestamp",
        "format": "date_time"
      },
      {
        "field": "event.ingested",
        "format": "date_time"
      },
      {
        "field": "process.cpu.start_time",
        "format": "date_time"
      },
      {
        "field": "system.process.cpu.start_time",
        "format": "date_time"
      }
    ],
    "script_fields": {},
    "stored_fields": [
      "*"
    ],
    "runtime_mappings": {},
    "_source": {
      "excludes": []
    },
    "query": {
      "bool": {
        "must": [],
        "filter": [
          {
            "match_phrase": {
              "data_stream.dataset": "kubernetes.pod"
            }
          },
          {
            "range": {
              "@timestamp": {
                "format": "strict_date_optional_time",
                "gte": "2023-01-19T13:23:09.807Z",
                "lte": "2023-01-19T13:38:09.807Z"
              }
            }
          }
        ],
        "should": [],
        "must_not": []
      }
    }
  }  
},
{
  "name": "cpu_usage_by_pod_last_15_seconds",
  "operation-type": "search",
  "body": {
    "aggs": {
      "0": {
        "terms": {
          "field": "kubernetes.pod.name",
          "order": {
            "2": "desc"
          },
          "size": 100
        },
        "aggs": {
          "1": {
            "date_histogram": {
              "field": "@timestamp",
              "fixed_interval": "30s",
              "time_zone": "Europe/Athens",
              "extended_bounds": {
                "min": "2023-01-19T13:37:54.807Z",
                "max": "2023-01-19T13:38:09.807Z"
              }
            },
            "aggs": {
              "2": {
                "avg": {
                  "field": "kubernetes.pod.cpu.usage.limit.pct"
                }
              }
            }
          },
          "2": {
            "avg": {
              "field": "kubernetes.pod.cpu.usage.limit.pct"
            }
          }
        }
      }
    },
    "size": 0,
    "fields": [
      {
        "field": "@timestamp",
        "format": "date_time"
      },
      {
        "field": "event.ingested",
        "format": "date_time"
      },
      {
        "field": "process.cpu.start_time",
        "format": "date_time"
      },
      {
        "field": "system.process.cpu.start_time",
        "format": "date_time"
      }
    ],
    "script_fields": {},
    "stored_fields": [
      "*"
    ],
    "runtime_mappings": {},
    "_source": {
      "excludes": []
    },
    "query": {
      "bool": {
        "must": [],
        "filter": [
          {
            "match_phrase": {
              "data_stream.dataset": "kubernetes.pod"
            }
          },
          {
            "range": {
              "@timestamp": {
                "format": "strict_date_optional_time",
                "gte": "2023-01-19T13:37:54.807Z",
                "lte": "2023-01-19T13:38:09.807Z"
              }
            }
          }
        ],
        "should": [],
        "must_not": []
      }
    }
  }  
},
{
  "name": "memory_usage_by_pod_last_3_hours",
  "operation-type": "search",
  "body": {
    "aggs": {
      "0": {
        "terms": {
          "field": "kubernetes.pod.name",
          "order": {
            "2": "desc"
          },
          "size": 100
        },
        "aggs": {
          "1": {
            "date_histogram": {
              "field": "@timestamp",
              "fixed_interval": "30s",
              "time_zone": "Europe/Athens",
              "extended_bounds": {
                "min": "2023-01-19T10:38:09.807Z",
                "max": "2023-01-19T13:38:09.807Z"
              }
            },
            "aggs": {
              "2": {
                "avg": {
                  "field": "kubernetes.pod.memory.usage.node.pct"
                }
              }
            }
          },
          "2": {
            "avg": {
              "field": "kubernetes.pod.memory.usage.node.pct"
            }
          }
        }
      }
    },
    "size": 0,
    "fields": [
      {
        "field": "@timestamp",
        "format": "date_time"
      },
      {
        "field": "event.ingested",
        "format": "date_time"
      },
      {
        "field": "process.cpu.start_time",
        "format": "date_time"
      },
      {
        "field": "system.process.cpu.start_time",
        "format": "date_time"
      }
    ],
    "script_fields": {},
    "stored_fields": [
      "*"
    ],
    "runtime_mappings": {},
    "_source": {
      "excludes": []
    },
    "query": {
      "bool": {
        "must": [],
        "filter": [
          {
            "match_phrase": {
              "data_stream.dataset": "kubernetes.pod"
            }
          },
          {
            "range": {
              "@timestamp": {
                "format": "strict_date_optional_time",
                "gte": "2023-01-19T10:38:09.807Z",
                "lte": "2023-01-19T13:38:09.807Z"
              }
            }
          }
        ],
        "should": [],
        "must_not": []
      }
    }
  }  
},
{
  "name": "memory_usage_by_pod_last_15_minutes",
  "operation-type": "search",
  "body": {
    "aggs": {
      "0": {
        "terms": {
          "field": "kubernetes.pod.name",
          "order": {
            "2": "desc"
          },
          "size": 100
        },
        "aggs": {
          "1": {
            "date_histogram": {
              "field": "@timestamp",
              "fixed_interval": "30s",
              "time_zone": "Europe/Athens",
              "extended_bounds": {
                "min": "2023-01-19T13:23:09.807Z",
                "max": "2023-01-19T13:38:09.807Z"
              }
            },
            "aggs": {
              "2": {
                "avg": {
                  "field": "kubernetes.pod.memory.usage.node.pct"
                }
              }
            }
          },
          "2": {
            "avg": {
              "field": "kubernetes.pod.memory.usage.node.pct"
            }
          }
        }
      }
    },
    "size": 0,
    "fields": [
      {
        "field": "@timestamp",
        "format": "date_time"
      },
      {
        "field": "event.ingested",
        "format": "date_time"
      },
      {
        "field": "process.cpu.start_time",
        "format": "date_time"
      },
      {
        "field": "system.process.cpu.start_time",
        "format": "date_time"
      }
    ],
    "script_fields": {},
    "stored_fields": [
      "*"
    ],
    "runtime_mappings": {},
    "_source": {
      "excludes": []
    },
    "query": {
      "bool": {
        "must": [],
        "filter": [
          {
            "match_phrase": {
              "data_stream.dataset": "kubernetes.pod"
            }
          },
          {
            "range": {
              "@timestamp": {
                "format": "strict_date_optional_time",
                "gte": "2023-01-19T13:23:09.807Z",
                "lte": "2023-01-19T13:38:09.807Z"
              }
            }
          }
        ],
        "should": [],
        "must_not": []
      }
    }
  }  
},
{
  "name": "memory_usage_by_pod_last_15_seconds",
  "operation-type": "search",
  "body": {
    "aggs": {
      "0": {
        "terms": {
          "field": "kubernetes.pod.name",
          "order": {
            "2": "desc"
          },
          "size": 100
        },
        "aggs": {
          "1": {
            "date_histogram": {
              "field": "@timestamp",
              "fixed_interval": "30s",
              "time_zone": "Europe/Athens",
              "extended_bounds": {
                "min": "2023-01-19T13:37:54.807Z",
                "max": "2023-01-19T13:38:09.807Z"
              }
            },
            "aggs": {
              "2": {
                "avg": {
                  "field": "kubernetes.pod.memory.usage.node.pct"
                }
              }
            }
          },
          "2": {
            "avg": {
              "field": "kubernetes.pod.memory.usage.node.pct"
            }
          }
        }
      }
    },
    "size": 0,
    "fields": [
      {
        "field": "@timestamp",
        "format": "date_time"
      },
      {
        "field": "event.ingested",
        "format": "date_time"
      },
      {
        "field": "process.cpu.start_time",
        "format": "date_time"
      },
      {
        "field": "system.process.cpu.start_time",
        "format": "date_time"
      }
    ],
    "script_fields": {},
    "stored_fields": [
      "*"
    ],
    "runtime_mappings": {},
    "_source": {
      "excludes": []
    },
    "query": {
      "bool": {
        "must": [],
        "filter": [
          {
            "match_phrase": {
              "data_stream.dataset": "kubernetes.pod"
            }
          },
          {
            "range": {
              "@timestamp": {
                "format": "strict_date_optional_time",
                "gte": "2023-01-19T13:37:54.807Z",
                "lte": "2023-01-19T13:38:09.807Z"
              }
            }
          }
        ],
        "should": [],
        "must_not": []
      }
    }
  }  
}
