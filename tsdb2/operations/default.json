{
  "name": "index-container",
  "operation-type": "bulk",
  "corpora" : "k8s-container",
  "bulk-size": {{bulk_size | default(2000)}},
  "ingest-percentage": {{ingest_percentage | default(100)}}
},
{
  "name": "index-node",
  "operation-type": "bulk",
  "corpora" : "k8s-node",
  "bulk-size": {{bulk_size | default(2000)}},
  "ingest-percentage": {{ingest_percentage | default(100)}}
},
{
  "name": "index-pod",
  "operation-type": "bulk",
  "corpora" : "k8s-pod",
  "bulk-size": {{bulk_size | default(5000)}},
  "ingest-percentage": {{ingest_percentage | default(100)}}
},
{
  "name": "touch-container-index",
  "operation-type": "raw-request",
  "method": "POST",
  "path": "/k8s-container/_doc",
  "request-params": {
    "pipeline": "timestamp_pipeline",
    "refresh": "true"
  },
  "body": {
    "@timestamp": "2023-03-22T14:35:53.842Z",
    "container": {
      "id": "test"
    },
    "kubernetes": {
      "container": {
        "id": "test" 
      },
      "namespace": "test",
      "pod": {
        "name": "test",
        "uid": "test"
      }
    }
  }
},
{
  "name": "touch-pod-index",
  "operation-type": "raw-request",
  "method": "POST",
  "path": "/k8s-pod/_doc",
  "request-params": {
    "pipeline": "timestamp_pipeline",
    "refresh": "true"
  },
  "body": {
    "@timestamp": "2023-03-22T14:35:53.842Z",
    "container": {
      "id": "test"
    },
    "kubernetes": {
      "container": {
        "id": "test" 
      },
      "namespace": "test",
      "pod": {
        "name": "test",
        "uid": "test"
      }
    }
  }
},
{
  "name": "average_container_cpu_1day",
  "data-stream": "k8s-container",
  "operation-type": "search",
  "body": {
    "aggs": {
      "0": {
        "terms": {
          "field": "kubernetes.container.name",
          "order": {
            "2": "desc"
          },
          "size": 20
        },
        "aggs": {
          "1": {
            "date_histogram": {
              "field": "@timestamp",
              "fixed_interval": "30s",
              "time_zone": "Europe/Athens",
              "extended_bounds": {
                "min": "2023-03-22T14:20:53.842Z",
                "max": "2023-03-22T14:35:53.842Z"
              }
            },
            "aggs": {
              "2": {
                "avg": {
                  "field": "kubernetes.container.cpu.usage.core.ns"
                }
              }
            }
          },
          "2": {
            "avg": {
              "field": "kubernetes.container.cpu.usage.core.ns"
            }
          }
        }
      }
    },
    "size": 0,
    "fields": [
      {
        "field": "@timestamp",
        "format": "date_time"
      },
      {
        "field": "event.ingested",
        "format": "date_time"
      },
      {
        "field": "process.cpu.start_time",
        "format": "date_time"
      },
      {
        "field": "system.process.cpu.start_time",
        "format": "date_time"
      }
    ],
    "script_fields": {},
    "stored_fields": [
      "*"
    ],
    "runtime_mappings": {},
    "_source": {
      "excludes": []
    },
    "query": {
      "bool": {
        "must": [],
        "filter": [
          {
            "match_phrase": {
              "data_stream.dataset": "kubernetes.container"
            }
          },
          {
            "range": {
              "@timestamp": {
                "format": "strict_date_optional_time",
                "gte": "2023-03-22T14:20:53.842Z",
                "lte": "2023-03-22T14:38:12.375Z"
              }
            }
          }
        ],
        "should": [],
        "must_not": []
      }
    }
  }  
},
{
  "name": "average_container_memory_usage_1d",
  "data-stream": "k8s-container",
  "operation-type": "search",
  "body": {
    "aggs": {
      "0": {
        "terms": {
          "field": "kubernetes.container.name",
          "order": {
            "2": "desc"
          },
          "size": 20
        },
        "aggs": {
          "1": {
            "date_histogram": {
              "field": "@timestamp",
              "fixed_interval": "30s",
              "time_zone": "Europe/Athens",
              "extended_bounds": {
                "min": "2023-03-22T14:20:53.842Z",
                "max": "2023-03-22T14:35:53.842Z"
              }
            },
            "aggs": {
              "2": {
                "avg": {
                  "field": "kubernetes.container.memory.usage.bytes"
                }
              }
            }
          },
          "2": {
            "avg": {
              "field": "kubernetes.container.memory.usage.bytes"
            }
          }
        }
      }
    },
    "size": 0,
    "fields": [
      {
        "field": "@timestamp",
        "format": "date_time"
      },
      {
        "field": "event.ingested",
        "format": "date_time"
      },
      {
        "field": "process.cpu.start_time",
        "format": "date_time"
      },
      {
        "field": "system.process.cpu.start_time",
        "format": "date_time"
      }
    ],
    "script_fields": {},
    "stored_fields": [
      "*"
    ],
    "runtime_mappings": {},
    "_source": {
      "excludes": []
    },
    "query": {
      "bool": {
        "must": [],
        "filter": [
          {
            "match_phrase": {
              "data_stream.dataset": "kubernetes.container"
            }
          },
          {
            "range": {
              "@timestamp": {
                "format": "strict_date_optional_time",
                "gte": "2023-03-22T14:20:53.842Z",
                "lte": "2023-03-22T14:38:12.375Z"
              }
            }
          }
        ],
        "should": [],
        "must_not": []
      }
    }
  }  
},
{
  "name": "cpu_usage_per_container_1d",
  "data-stream": "k8s-container",
  "operation-type": "search",
  "body": {
    "aggs": {
      "0": {
        "terms": {
          "field": "kubernetes.container.name",
          "order": {
            "2": "desc"
          },
          "size": 10,
          "shard_size": 25
        },
        "aggs": {
          "1": {
            "date_histogram": {
              "field": "@timestamp",
              "fixed_interval": "30s",
              "time_zone": "Europe/Athens",
              "extended_bounds": {
                "min": "2023-03-22T14:20:53.842Z",
                "max": "2023-03-22T14:35:53.842Z"
              }
            },
            "aggs": {
              "2": {
                "avg": {
                  "field": "kubernetes.container.cpu.usage.node.pct"
                }
              }
            }
          },
          "2": {
            "avg": {
              "field": "kubernetes.container.cpu.usage.node.pct"
            }
          }
        }
      }
    },
    "size": 0,
    "fields": [
      {
        "field": "@timestamp",
        "format": "date_time"
      },
      {
        "field": "event.ingested",
        "format": "date_time"
      },
      {
        "field": "process.cpu.start_time",
        "format": "date_time"
      },
      {
        "field": "system.process.cpu.start_time",
        "format": "date_time"
      }
    ],
    "script_fields": {},
    "stored_fields": [
      "*"
    ],
    "runtime_mappings": {},
    "_source": {
      "excludes": []
    },
    "query": {
      "bool": {
        "must": [],
        "filter": [
          {
            "match_phrase": {
              "data_stream.dataset": "kubernetes.container"
            }
          },
          {
            "range": {
              "@timestamp": {
                "format": "strict_date_optional_time",
                "gte": "2023-03-22T14:20:53.842Z",
                "lte": "2023-03-22T14:38:12.375Z"
              }
            }
          }
        ],
        "should": [],
        "must_not": []
      }
    }
  }  
},
{
  "name": "cpu_usage_per_pod_1d",
  "data-stream": "k8s-pod",
  "operation-type": "search",
  "body": {
    "aggs": {
      "0": {
        "terms": {
          "field": "kubernetes.pod.name",
          "order": {
            "2": "desc"
          },
          "size": 100
        },
        "aggs": {
          "1": {
            "date_histogram": {
              "field": "@timestamp",
              "fixed_interval": "30s",
              "time_zone": "Europe/Athens",
              "extended_bounds": {
                "min": "2023-03-22T14:20:53.842Z",
                "max": "2023-03-22T14:35:53.842Z"
              }
            },
            "aggs": {
              "2": {
                "avg": {
                  "field": "kubernetes.pod.cpu.usage.limit.pct"
                }
              }
            }
          },
          "2": {
            "avg": {
              "field": "kubernetes.pod.cpu.usage.limit.pct"
            }
          }
        }
      }
    },
    "size": 0,
    "fields": [
      {
        "field": "@timestamp",
        "format": "date_time"
      },
      {
        "field": "event.ingested",
        "format": "date_time"
      },
      {
        "field": "process.cpu.start_time",
        "format": "date_time"
      },
      {
        "field": "system.process.cpu.start_time",
        "format": "date_time"
      }
    ],
    "script_fields": {},
    "stored_fields": [
      "*"
    ],
    "runtime_mappings": {},
    "_source": {
      "excludes": []
    },
    "query": {
      "bool": {
        "must": [],
        "filter": [
          {
            "match_phrase": {
              "data_stream.dataset": "kubernetes.pod"
            }
          },
          {
            "range": {
              "@timestamp": {
                "format": "strict_date_optional_time",
                "gte": "2023-03-22T14:20:53.842Z",
                "lte": "2023-03-22T14:35:53.842Z"
              }
            }
          }
        ],
        "should": [],
        "must_not": []
      }
    }
  }  
},
{
  "name": "memory_usage_per_container_1d",
  "data-stream": "k8s-container",
  "operation-type": "search",
  "body": {
    "aggs": {
      "0": {
        "terms": {
          "field": "kubernetes.container.name",
          "order": {
            "2": "desc"
          },
          "size": 20
        },
        "aggs": {
          "1": {
            "date_histogram": {
              "field": "@timestamp",
              "fixed_interval": "30s",
              "time_zone": "Europe/Athens",
              "extended_bounds": {
                "min": "2023-03-22T14:20:53.842Z",
                "max": "2023-03-22T14:35:53.842Z"
              }
            },
            "aggs": {
              "2": {
                "avg": {
                  "field": "kubernetes.container.memory.usage.node.pct"
                }
              }
            }
          },
          "2": {
            "avg": {
              "field": "kubernetes.container.memory.usage.node.pct"
            }
          }
        }
      }
    },
    "size": 0,
    "fields": [
      {
        "field": "@timestamp",
        "format": "date_time"
      },
      {
        "field": "event.ingested",
        "format": "date_time"
      },
      {
        "field": "process.cpu.start_time",
        "format": "date_time"
      },
      {
        "field": "system.process.cpu.start_time",
        "format": "date_time"
      }
    ],
    "script_fields": {},
    "stored_fields": [
      "*"
    ],
    "runtime_mappings": {},
    "_source": {
      "excludes": []
    },
    "query": {
      "bool": {
        "must": [],
        "filter": [
          {
            "match_phrase": {
              "data_stream.dataset": "kubernetes.container"
            }
          },
          {
            "range": {
              "@timestamp": {
                "format": "strict_date_optional_time",
                "gte": "2023-03-22T14:20:53.842Z",
                "lte": "2023-03-22T14:38:12.375Z"
              }
            }
          }
        ],
        "should": [],
        "must_not": []
      }
    }
  }  
},
{
  "name": "memory_usage_per_pod_1d",
  "data-stream": "k8s-pod",
  "operation-type": "search",
  "body": {
    "aggs": {
      "0": {
        "terms": {
          "field": "kubernetes.pod.name",
          "order": {
            "2": "desc"
          },
          "size": 100
        },
        "aggs": {
          "1": {
            "date_histogram": {
              "field": "@timestamp",
              "fixed_interval": "30s",
              "time_zone": "Europe/Athens",
              "extended_bounds": {
                "min": "2023-03-22T14:20:53.842Z",
                "max": "2023-03-22T14:35:53.842Z"
              }
            },
            "aggs": {
              "2": {
                "avg": {
                  "field": "kubernetes.pod.memory.usage.node.pct"
                }
              }
            }
          },
          "2": {
            "avg": {
              "field": "kubernetes.pod.memory.usage.node.pct"
            }
          }
        }
      }
    },
    "size": 0,
    "fields": [
      {
        "field": "@timestamp",
        "format": "date_time"
      },
      {
        "field": "event.ingested",
        "format": "date_time"
      },
      {
        "field": "process.cpu.start_time",
        "format": "date_time"
      },
      {
        "field": "system.process.cpu.start_time",
        "format": "date_time"
      }
    ],
    "script_fields": {},
    "stored_fields": [
      "*"
    ],
    "runtime_mappings": {},
    "_source": {
      "excludes": []
    },
    "query": {
      "bool": {
        "must": [],
        "filter": [
          {
            "match_phrase": {
              "data_stream.dataset": "kubernetes.pod"
            }
          },
          {
            "match_phrase": {
              "data_stream.dataset": "kubernetes.pod"
            }
          },
          {
            "range": {
              "@timestamp": {
                "format": "strict_date_optional_time",
                "gte": "2023-03-22T14:20:53.842Z",
                "lte": "2023-03-22T14:35:53.842Z"
              }
            }
          }
        ],
        "should": [],
        "must_not": []
      }
    }
  }  
},
{
  "name": "unique_deployment_count_1d",
  "data-stream": "k8s-*",
  "operation-type": "search",
  "body": {
    "aggs": {
      "0": {
        "cardinality": {
          "field": "kubernetes.deployment.name"
        }
      }
    },
    "size": 0,
    "fields": [
      {
        "field": "@timestamp",
        "format": "date_time"
      },
      {
        "field": "event.ingested",
        "format": "date_time"
      },
      {
        "field": "process.cpu.start_time",
        "format": "date_time"
      },
      {
        "field": "system.process.cpu.start_time",
        "format": "date_time"
      }
    ],
    "script_fields": {},
    "stored_fields": [
      "*"
    ],
    "runtime_mappings": {},
    "_source": {
      "excludes": []
    },
    "query": {
      "bool": {
        "must": [],
        "filter": [
          {
            "range": {
              "@timestamp": {
                "format": "strict_date_optional_time",
                "gte": "2023-03-22T14:20:53.842Z",
                "lte": "2023-03-22T14:35:53.842Z"
              }
            }
          }
        ],
        "should": [],
        "must_not": []
      }
    }
  }  
},
{
  "name": "updated_average_container_cpu_1day",
  "data-stream": "k8s-container",
  "operation-type": "search",
  "body": {
      "aggs": {
        "0": {
          "terms": {
            "field": "kubernetes.container.name",
            "order": {
              "2": "desc"
            },
            "size": 20
          },
          "aggs": {
            "1": {
              "date_histogram": {
                "field": "@timestamp",
                "fixed_interval": "30m",
                "time_zone": "Europe/Athens",
                "min_doc_count": 1
              },
              "aggs": {
                "2": {
                  "avg": {
                    "field": "kubernetes.container.cpu.usage.core.ns"
                  }
                }
              }
            },
            "2": {
              "avg": {
                "field": "kubernetes.container.cpu.usage.core.ns"
              }
            }
          }
        }
      },
      "size": 0,
      "fields": [
        {
          "field": "@timestamp",
          "format": "date_time"
        },
        {
          "field": "event.ingested",
          "format": "date_time"
        },
        {
          "field": "process.cpu.start_time",
          "format": "date_time"
        },
        {
          "field": "system.process.cpu.start_time",
          "format": "date_time"
        }
      ],
      "script_fields": {},
      "stored_fields": [
        "*"
      ],
      "runtime_mappings": {},
      "_source": {
        "excludes": []
      },
      "query": {
        "bool": {
          "must": [],
          "filter": [
            {
              "match_phrase": {
                "data_stream.dataset": "kubernetes.container"
              }
            },
            {
              "range": {
                "@timestamp": {
                  "format": "strict_date_optional_time",
                  "gte": "2023-03-21T15:58:14.780Z",
                  "lte": "2023-03-22T14:38:12.375Z"
                }
              }
            }
          ],
          "should": [],
          "must_not": []
        }
      }
    }
},
{
  "name": "updated_average_container_memory_usage_1d",
  "data-stream": "k8s-container",
  "operation-type": "search",
  "body": {
      "aggs": {
        "0": {
          "terms": {
            "field": "kubernetes.container.name",
            "order": {
              "2": "desc"
            },
            "size": 20
          },
          "aggs": {
            "1": {
              "date_histogram": {
                "field": "@timestamp",
                "fixed_interval": "30s",
                "time_zone": "Europe/Athens",
                "min_doc_count": 1
              },
              "aggs": {
                "2": {
                  "avg": {
                    "field": "kubernetes.container.memory.usage.bytes"
                  }
                }
              }
            },
            "2": {
              "avg": {
                "field": "kubernetes.container.memory.usage.bytes"
              }
            }
          }
        }
      },
      "size": 0,
      "fields": [
        {
          "field": "@timestamp",
          "format": "date_time"
        },
        {
          "field": "event.ingested",
          "format": "date_time"
        },
        {
          "field": "process.cpu.start_time",
          "format": "date_time"
        },
        {
          "field": "system.process.cpu.start_time",
          "format": "date_time"
        }
      ],
      "script_fields": {},
      "stored_fields": [
        "*"
      ],
      "runtime_mappings": {},
      "_source": {
        "excludes": []
      },
      "query": {
        "bool": {
          "must": [],
          "filter": [
            {
              "match_phrase": {
                "data_stream.dataset": "kubernetes.container"
              }
            },
            {
              "range": {
                "@timestamp": {
                  "format": "strict_date_optional_time",
                  "gte": "2023-03-21T15:58:14.780Z",
                  "lte": "2023-03-22T14:38:12.375Z"
                }
              }
            }
          ],
          "should": [],
          "must_not": []
        }
      }
    }      
},
{
  "name": "updated_cpu_usage_per_container_1d",
  "data-stream": "k8s-container",
  "operation-type": "search",
  "body": {
      "aggs": {
        "0": {
          "terms": {
            "field": "kubernetes.container.name",
            "order": {
              "2": "desc"
            },
            "size": 10,
            "shard_size": 25
          },
          "aggs": {
            "1": {
              "date_histogram": {
                "field": "@timestamp",
                "fixed_interval": "30m",
                "time_zone": "Europe/Athens",
                "min_doc_count": 1
              },
              "aggs": {
                "2": {
                  "avg": {
                    "field": "kubernetes.container.cpu.usage.node.pct"
                  }
                }
              }
            },
            "2": {
              "avg": {
                "field": "kubernetes.container.cpu.usage.node.pct"
              }
            }
          }
        }
      },
      "size": 0,
      "fields": [
        {
          "field": "@timestamp",
          "format": "date_time"
        },
        {
          "field": "event.ingested",
          "format": "date_time"
        },
        {
          "field": "process.cpu.start_time",
          "format": "date_time"
        },
        {
          "field": "system.process.cpu.start_time",
          "format": "date_time"
        }
      ],
      "script_fields": {},
      "stored_fields": [
        "*"
      ],
      "runtime_mappings": {},
      "_source": {
        "excludes": []
      },
      "query": {
        "bool": {
          "must": [],
          "filter": [
            {
              "match_phrase": {
                "data_stream.dataset": "kubernetes.container"
              }
            },
            {
              "range": {
                "@timestamp": {
                  "format": "strict_date_optional_time",
                  "gte": "2023-03-21T15:58:14.780Z",
                  "lte": "2023-03-22T14:38:12.375Z"
                }
              }
            }
          ],
          "should": [],
          "must_not": []
        }
      }
    } 
},
{
  "name": "updated_cpu_usage_per_pod_1d",
  "data-stream": "k8s-pod",
  "operation-type": "search",
  "body": {
      "aggs": {
        "0": {
          "terms": {
            "field": "kubernetes.pod.name",
            "order": {
              "2": "desc"
            },
            "size": 100
          },
          "aggs": {
            "1": {
              "date_histogram": {
                "field": "@timestamp",
                "fixed_interval": "30m",
                "time_zone": "Europe/Athens",
                "min_doc_count": 1
              },
              "aggs": {
                "2": {
                  "avg": {
                    "field": "kubernetes.pod.cpu.usage.limit.pct"
                  }
                }
              }
            },
            "2": {
              "avg": {
                "field": "kubernetes.pod.cpu.usage.limit.pct"
              }
            }
          }
        }
      },
      "size": 0,
      "fields": [
        {
          "field": "@timestamp",
          "format": "date_time"
        },
        {
          "field": "event.ingested",
          "format": "date_time"
        },
        {
          "field": "process.cpu.start_time",
          "format": "date_time"
        },
        {
          "field": "system.process.cpu.start_time",
          "format": "date_time"
        }
      ],
      "script_fields": {},
      "stored_fields": [
        "*"
      ],
      "runtime_mappings": {},
      "_source": {
        "excludes": []
      },
      "query": {
        "bool": {
          "must": [],
          "filter": [
            {
              "match_phrase": {
                "data_stream.dataset": "kubernetes.pod"
              }
            },
            {
              "range": {
                "@timestamp": {
                  "format": "strict_date_optional_time",
                  "gte": "2023-03-21T23:18:31.796Z",
                  "lte": "2023-03-22T14:35:53.842Z"
                }
              }
            }
          ],
          "should": [],
          "must_not": []
        }
      }
    }
},
{
  "name": "updated_memory_usage_per_container_1d",
  "data-stream": "k8s-container",
  "operation-type": "search",
  "body": {
      "aggs": {
        "0": {
          "terms": {
            "field": "kubernetes.container.name",
            "order": {
              "2": "desc"
            },
            "size": 20
          },
          "aggs": {
            "1": {
              "date_histogram": {
                "field": "@timestamp",
                "fixed_interval": "30m",
                "time_zone": "Europe/Athens",
                "min_doc_count": 1
              },
              "aggs": {
                "2": {
                  "avg": {
                    "field": "kubernetes.container.memory.usage.node.pct"
                  }
                }
              }
            },
            "2": {
              "avg": {
                "field": "kubernetes.container.memory.usage.node.pct"
              }
            }
          }
        }
      },
      "size": 0,
      "fields": [
        {
          "field": "@timestamp",
          "format": "date_time"
        },
        {
          "field": "event.ingested",
          "format": "date_time"
        },
        {
          "field": "process.cpu.start_time",
          "format": "date_time"
        },
        {
          "field": "system.process.cpu.start_time",
          "format": "date_time"
        }
      ],
      "script_fields": {},
      "stored_fields": [
        "*"
      ],
      "runtime_mappings": {},
      "_source": {
        "excludes": []
      },
      "query": {
        "bool": {
          "must": [],
          "filter": [
            {
              "match_phrase": {
                "data_stream.dataset": "kubernetes.container"
              }
            },
            {
              "range": {
                "@timestamp": {
                  "format": "strict_date_optional_time",
                  "gte": "2023-03-21T15:58:14.780Z",
                  "lte": "2023-03-22T14:38:12.375Z"
                }
              }
            }
          ],
          "should": [],
          "must_not": []
        }
      }
    }
},
{
  "name": "updated_memory_usage_per_pod_1d",
  "data-stream": "k8s-pod",
  "operation-type": "search",
  "body": {
      "aggs": {
        "0": {
          "terms": {
            "field": "kubernetes.pod.name",
            "order": {
              "2": "desc"
            },
            "size": 100
          },
          "aggs": {
            "1": {
              "date_histogram": {
                "field": "@timestamp",
                "fixed_interval": "30m",
                "time_zone": "Europe/Athens",
                "min_doc_count": 1
              },
              "aggs": {
                "2": {
                  "avg": {
                    "field": "kubernetes.pod.memory.usage.node.pct"
                  }
                }
              }
            },
            "2": {
              "avg": {
                "field": "kubernetes.pod.memory.usage.node.pct"
              }
            }
          }
        }
      },
      "size": 0,
      "fields": [
        {
          "field": "@timestamp",
          "format": "date_time"
        },
        {
          "field": "event.ingested",
          "format": "date_time"
        },
        {
          "field": "process.cpu.start_time",
          "format": "date_time"
        },
        {
          "field": "system.process.cpu.start_time",
          "format": "date_time"
        }
      ],
      "script_fields": {},
      "stored_fields": [
        "*"
      ],
      "runtime_mappings": {},
      "_source": {
        "excludes": []
      },
      "query": {
        "bool": {
          "must": [],
          "filter": [
            {
              "match_phrase": {
                "data_stream.dataset": "kubernetes.pod"
              }
            },
            {
              "range": {
                "@timestamp": {
                  "format": "strict_date_optional_time",
                  "gte": "2023-03-21T23:18:31.796Z",
                  "lte": "2023-03-22T14:35:53.842Z"
                }
              }
            }
          ],
          "should": [],
          "must_not": []
        }
      }
    }  
},
{
  "name": "updated_unique_deployment_count_1d",
  "data-stream": "k8s-*",
  "operation-type": "search",
  "body": {
      "aggs": {
        "0": {
          "cardinality": {
            "field": "kubernetes.deployment.name"
          }
        }
      },
      "size": 0,
      "fields": [
        {
          "field": "@timestamp",
          "format": "date_time"
        },
        {
          "field": "event.ingested",
          "format": "date_time"
        },
        {
          "field": "process.cpu.start_time",
          "format": "date_time"
        },
        {
          "field": "system.process.cpu.start_time",
          "format": "date_time"
        }
      ],
      "script_fields": {},
      "stored_fields": [
        "*"
      ],
      "runtime_mappings": {},
      "_source": {
        "excludes": []
      },
      "query": {
        "bool": {
          "must": [],
          "filter": [
            {
              "match_phrase": {
                "data_stream.dataset": "kubernetes.pod"
              }
            },
            {
              "range": {
                "@timestamp": {
                  "format": "strict_date_optional_time",
                  "gte": "2023-03-21T23:18:31.796Z",
                  "lte": "2023-03-22T14:35:53.842Z"
                }
              }
            }
          ],
          "should": [],
          "must_not": []
        }
      }
    }  
},
{
  "name": "Percentile_cpu_usage_per_container_1d",
  "data-stream": "k8s-*",
  "operation-type": "search",
  "body": {
      "aggs": {
        "0": {
          "date_histogram": {
            "field": "@timestamp",
            "fixed_interval": "30m",
            "time_zone": "Europe/Athens",
            "min_doc_count": 1
          },
          "aggs": {
            "1": {
              "percentiles": {
                "field": "kubernetes.container.cpu.usage.nanocores",
                "percents": [
                  95
                ]
              }
            }
          }
        }
      },
      "size": 0,
      "fields": [
        {
          "field": "@timestamp",
          "format": "date_time"
        },
        {
          "field": "event.ingested",
          "format": "date_time"
        },
        {
          "field": "process.cpu.start_time",
          "format": "date_time"
        },
        {
          "field": "system.process.cpu.start_time",
          "format": "date_time"
        }
      ],
      "script_fields": {},
      "stored_fields": [
        "*"
      ],
      "runtime_mappings": {},
      "_source": {
        "excludes": []
      },
      "query": {
        "bool": {
          "must": [],
          "filter": [
            {
              "match_phrase": {
                "data_stream.dataset": "kubernetes.container"
              }
            },
            {
              "range": {
                "@timestamp": {
                  "format": "strict_date_optional_time",
                  "gte": "2023-03-21T23:18:31.796Z",
                  "lte": "2023-03-22T14:35:53.842Z"
                }
              }
            }
          ],
          "should": [],
          "must_not": []
        }
      }
    } 
}
